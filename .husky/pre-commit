branch="$(git symbolic-ref --short HEAD 2>/dev/null)"

if [ "$branch" = "main" ]; then
  echo "Committing directly to 'main' is blocked. Please switch to a feature branch."
  exit 1
fi

# Run linting and formatting
npx lint-staged

# Check for constants changes and warn about deployment
.husky/check-constants

# Check for high cognitive complexity
.husky/check-complexity

# Check for file length limits
.husky/check-file-length

# Run tests to ensure no regressions.
# --silent keeps pre-commit output focused on real test failures.
CI=true npm test -- --no-watch --no-coverage --bail --watchman=false --silent

appId: ${APP_ID}
---
# Helper flow: Ensure we're on a specific screen
# This flow intelligently handles navigation:
# - If on login screen -> login first
# - If already on target screen -> do nothing
# - Otherwise -> navigate to target screen
#
# Usage:
#   - runFlow:
#       file: flows/ensure-on-screen.yaml
#       env:
#         screen_id: "screen-collections"
#         tab_text: "Collections"
#
# Parameters:
#   screen_id: testID for the target screen root
#   tab_text: Visible label of the tab button that opens the screen

# Ensure app is running
- launchApp

# Step 1: If on signup screen, go back to login
- runFlow:
    when:
      visible: "Create Account"
    commands:
      - tapOn:
          text: "Sign in"
      - waitForAnimationToEnd

# Step 2: If on login screen, login first
- runFlow:
    when:
      visible: "Welcome Back"
    commands:
      - runFlow: login-helper.yaml

# Step 3: Navigate to target screen if not already there
- runFlow:
    when:
      notVisible:
        id: ${screen_id}
    commands:
      - tapOn:
          text: ${tab_text}
      - waitForAnimationToEnd

# Step 4: Assert we're on the correct screen
- assertVisible:
    id: ${screen_id}
